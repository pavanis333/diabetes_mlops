- name: installing terraform and docker
  hosts: localhost
  vars_prompt:
          - name: profile
            prompt: "Enter profile "
          - name: access_key
            prompt: "Enter Access Key "
          - name: secret_access_key
            prompt: "Enter Secret Access Key "
          - name: token
            prompt: "Enter Session Token "
            default: " "
            
  tasks:
          - name: install yum-utils
            yum:
              name: yum-utils
              state: present
              
          - name: add terraform repository
            yum_repository:
              name: terraform
              description: terraform
              baseurl: https://rpm.releases.hashicorp.com/AmazonLinux/hashicorp.repo
              
          - name: install terraform
            yum:
              name: terraform
              state: present
              
          - name: configuring docker repository
            yum_repository:
              name: docker
              description: docker
              baseurl: https://download.docker.com/linux/centos/7/x86_64/stable/

          - name: installing docker
            yum:
              name: docker
              state: present
              
          - name: starting and enabling docker services
            service:
              name: docker
              state: started
              enabled: yes
                    
          - name: creating credentials file
            file:
              name: .aws
              path: /root/
          
          - name: saving aws credentials
            copy:
              content: "{{ profile }}"
              dest: /root/.aws/credentials
              
          - name: saving aws credentials
            copy:
              content: "{{ access_key }}"
              dest: /root/.aws/credentials
              
          - name: saving aws credentials
            copy:
              content: "{{ secret_access_key }}"
              dest: /root/.aws/credentials
          
          - name: saving aws credentials
            copy:
              content: "{{ token }}"
              dest: /root/.aws/credentials
          
          - name: run terraform code
            shell: terraform apply --auto-approve
